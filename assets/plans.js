// assets/plans.js
// مكتبة خطط مذاكرة مبنية على فهرس الدورة (بدون روابط القنوات — فقط تنظيم للمحتوى)

window.COURSE_INDEX = [
{id:1, track:"تمهيدي", title:"المقدمة وخطة الدورة"},
{id:2, track:"تمهيدي", title:"المفاهيم الأساسية لقواعد اللغة"},
{id:3, track:"تمهيدي", title:"القراءة والمهارات الأولية"},
{id:4, track:"تمهيدي", title:"مهارات الاستماع الأساسية"},
{id:5, track:"تمهيدي", title:"اختبار تجريبي تمهيدي مع الحل"},
{id:6, track:"Grammar", title:"قاعدة المضارع البسيط والمستمر"},
{id:7, track:"Grammar", title:"الأزمنة التامة – الماضي والحاضر"},
{id:8, track:"Grammar", title:"الأفعال الشرطية وأنواعها"},
{id:9, track:"Grammar", title:"ضمائر الوصل والأدوات النحوية الأخرى"},
{id:10, track:"Grammar", title:"مراجعة القواعد الأسبوعية 1"},
{id:11, track:"Grammar", title:"حلول نماذج القواعد (أول 20 نموذج)"},
{id:12, track:"الاستثناءات", title:"أهم الاستثناءات في الأزمنة"},
{id:13, track:"الاستثناءات", title:"استثناءات القواعد: الضمائر والصفات"},
{id:14, track:"الاستثناءات", title:"استثناءات القواعد المتقدمة"},
{id:15, track:"Reading", title:"استراتيجيات قراءة عامة"},
{id:16, track:"Reading", title:"القطع الأكثر تكرارًا مع الحل"},
{id:17, track:"Reading", title:"نصوص تدريبية بدون حلول (للتقييم الذاتي)"},
{id:18, track:"Reading", title:"مراجعة Reading الأسبوعية"},
{id:19, track:"Listening", title:"استراتيجيات الاستماع العامة"},
{id:20, track:"Listening", title:"نماذج Listening غير محلولة"},
{id:21, track:"Listening", title:"نماذج Listening محلولة"},
{id:22, track:"Listening", title:"Listening بدون مقاطع (تدريبات قصيرة)"},
{id:23, track:"النماذج", title:"نماذج 1–10 مع الحلول"},
{id:24, track:"النماذج", title:"نماذج 11–20 مع الحلول"},
{id:25, track:"النماذج", title:"نماذج 21–30 غير محلولة"},
{id:26, track:"النماذج", title:"مراجعة أسبوعية شاملة"}
];

window.PLAN_LIBRARY = {
  lt24: {
    title: "خطة يوم واحد (إنقاذ)",
    forWho: "اختبارك قريب جدًا (أقل من 24 ساعة) وتحتاج ترتيب سريع + أهم المهارات.",
    blocks: [
      {label:"صباحًا (60 دقيقة)", items:[
        "شاهد/راجع: (19) استراتيجيات الاستماع العامة + (15) استراتيجيات قراءة عامة.",
        "طبّق فوراً: 15 سؤال Grammar سريع + 10 مفردات ربط."
      ]},
      {label:"منتصف اليوم (120 دقيقة)", items:[
        "حل نموذج قراءة واحد بزمن محدد + راجع أخطاءك مباشرة.",
        "حل Listening بدون مقاطع (22) + راجع الكلمات المفتاحية."
      ]},
      {label:"مساءً (60 دقيقة)", items:[
        "راجع ملخصات سريعة + كبسولة الإنقاذ إن وجدت داخل ملفات الدورة.",
        "راجع أخطاء Grammar الشائعة عبر (10) مراجعة القواعد الأسبوعية 1."
      ]},
    ],
    closing: "اللهم يسّر لك الاختبار وافرّحك بالدرجة. لا تكثر مصادر اليوم — ركّز على التطبيق."
  },

  lt3: {
    title: "خطة 3 أيام (مكثفة)",
    forWho: "إذا عندك 3 أيام — نرفع الأداء بسرعة ونقفل الثغرات الأساسية.",
    days: [
      {day:1, title:"تأسيس سريع + ترتيب فهم الاختبار", items:[
        "شاهد التمهيدي: (1) المقدمة وخطة الدورة + (3) القراءة والمهارات الأولية + (4) مهارات الاستماع الأساسية.",
        "حل اختبار تمهيدي: (5) اختبار تجريبي تمهيدي مع الحل، ودوّن أخطاءك في ورقة واحدة."
      ]},
      {day:2, title:"قواعد مهمة + قراءة بزمن", items:[
        "Grammar: (6) المضارع البسيط/المستمر + (7) الأزمنة التامة + (8) الشرطيات.",
        "حل 30 سؤال Grammar من بنك الأسئلة + راجع (10) مراجعة القواعد الأسبوعية 1.",
        "Reading: شاهد (15) استراتيجيات قراءة عامة ثم حل قطعة واحدة بزمن محدد."
      ]},
      {day:3, title:"استماع + نماذج حديثة + مراجعة أخطاء", items:[
        "Listening: (19) الاستراتيجيات ثم حل (22) تدريبات قصيرة + نموذج Listening (20).",
        "نماذج: حل نموذج واحد شامل (من النماذج داخل القناة) ثم راجع (26) مراجعة أسبوعية شاملة.",
        "آخر 30 دقيقة: ركّز على نمط النماذج الحديثة (49–51) وفكرة الأسئلة المتكررة."
      ]},
    ],
    closing: "الزبدة: لا تكرر نفس الغلط مرتين — كل خطأ له علاج مباشر."
  },

  lt7: {
    title: "خطة 7 أيام (متوازنة)",
    forWho: "أسبوع واحد يعطيك وقت كفاية لتوازن بين الفهم والتطبيق.",
    days: [
      {day:1, title:"تمهيدي + تأسيس", items:[
        "ابدأ بـ (1) + (2) + (3) + (4).",
        "حل اختبار تمهيدي (5) وسجّل الأخطاء."
      ]},
      {day:2, title:"Grammar أساسيات", items:[
        "(6) المضارع + (7) الأزمنة التامة.",
        "تطبيق: 25 سؤال Grammar + مراجعة الأخطاء."
      ]},
      {day:3, title:"Grammar متقدم", items:[
        "(8) الشرطيات + (9) ضمائر الوصل.",
        "تطبيق: 25 سؤال Grammar + مراجعة (10)."
      ]},
      {day:4, title:"Reading مهارات", items:[
        "(15) استراتيجيات القراءة.",
        "حل قطعتين بزمن + راجع (18) مراجعة Reading الأسبوعية."
      ]},
      {day:5, title:"Listening مهارات", items:[
        "(19) استراتيجيات الاستماع.",
        "حل نموذج Listening (20) + تدريب قصير (22)."
      ]},
      {day:6, title:"نماذج + تثبيت", items:[
        "حل نموذج شامل (23 أو 24) بحسب المتاح للمشتركين.",
        "حل 15 سؤال إضافي في أضعف قسم عندك."
      ]},
      {day:7, title:"محاكاة نهائية + نماذج حديثة", items:[
        "Mock بزمن حقيقي + تحليل أخطاء.",
        "راجع نقاط النماذج الحديثة (49–51) وركز على إدارة الوقت."
      ]},
    ],
    closing: "دعاء: الله يفتح عليك ويبارك في وقتك. ثابت + تركيز = فرق كبير."
  },

  lt30: {
    title: "خطة 30 يوم (هادئة ومنظمة)",
    forWho: "إذا عندك شهر — نشتغل على أساس قوي ثم نماذج متدرجة.",
    weeks: [
      {week:1, title:"تمهيدي + تأسيس", items:[
        "التمهيدي (1–5) مع تطبيق بعد كل محاضرة.",
        "هدف الأسبوع: فهم نمط الاختبار + بناء روتين."
      ]},
      {week:2, title:"Grammar مكثف", items:[
        "(6–11) مع حل نماذج القواعد تدريجيًا.",
        "اكتب قائمة أخطاء ثابتة وراجعها كل يوم."
      ]},
      {week:3, title:"استثناءات + Reading", items:[
        "(12–14) ثم (15–18).",
        "طبق على قطع متكررة + قراءة بزمن."
      ]},
      {week:4, title:"Listening + نماذج كاملة", items:[
        "(19–22) ثم نماذج شاملة (23–26).",
        "آخر 3 أيام: نماذج حديثة (49–51) + إدارة وقت."
      ]},
    ],
    closing: "ملاحظة لطيفة: إذا ما حجزت موعدك — احجز بعد ما تثبت روتين أسبوعين على الأقل."
  },

  notBooked: {
    title: "ما حجزت موعدك؟ (خطة ذكية + نصيحة للحجز)",
    forWho: "إذا لسه ما حجزت — نرتب لك مسار يخليك تحجز بثقة بدل التوتر.",
    items: [
      "ابدأ بأسبوعين تأسيس (تمهيدي + Grammar أساسيات).",
      "بعدها قيّم نفسك بنموذج محاكي كامل — إذا صرت ثابت فوق 70% ابدأ في حجز الموعد.",
      "اختيار الموعد: لا تحجز وأنت لسه ما جرّبت محاكاة بزمن — خلك واقعي مع وقتك."
    ],
    closing: "الهدف مو إنك تحجز بسرعة — الهدف تحجز وأنت جاهز."
  }
};

window.pickPlanKey = function(examWindow){
  // examWindow values: lt24, lt3, lt7, lt30, notBooked
  if (!examWindow) return "notBooked";
  if (window.PLAN_LIBRARY && window.PLAN_LIBRARY[examWindow]) return examWindow;
  return "notBooked";
};

window.buildStudyPlan = function({examWindow, weakFocus, level}){
  const key = window.pickPlanKey(examWindow);
  const plan = JSON.parse(JSON.stringify(window.PLAN_LIBRARY[key]));
  // تعديل بسيط حسب نقطة الضعف
  if (weakFocus){
    const focusLabel = (weakFocus === "Listening") ? "الاستماع" : (weakFocus === "Reading") ? "القراءة" : "القواعد";
    plan.focusNote = "تركيزك الأكبر هذا الأسبوع على: " + focusLabel + " — لأنه أضعف قسم عندك حسب التحليل.";
  }
  if (level === "Beginner"){
    plan.levelNote = "مستواك (مبتدئ): ركّز على التأسيس ثم زد التحدي تدريجيًا. لا تحرق نفسك بنماذج كثيرة من البداية.";
  } else if (level === "Advanced"){
    plan.levelNote = "مستواك (متقدم): ركّز على السرعة + إدارة الوقت + النماذج الحديثة (49–51).";
  } else {
    plan.levelNote = "مستواك (متوسط): ثبّت القواعد الأساسية وطبّق يوميًا — وادخل نماذج تدريجيًا.";
  }
  return plan;
};
